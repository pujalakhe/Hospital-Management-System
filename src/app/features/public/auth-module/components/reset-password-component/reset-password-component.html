<div class="min-h-screen flex items-center justify-center bg-gray-100 px-4">
  <mat-card class="w-full max-w-md shadow-xl rounded-2xl p-6 bg-white">

    <!-- Header -->
    <div class="text-center mb-6">
      <mat-icon class="text-5xl text-blue-600 mb-2">lock_reset</mat-icon>
      <h2 class="text-2xl font-semibold text-gray-800">Reset Password</h2>
      <p class="text-gray-500 text-sm">Follow the steps to reset your password</p>
    </div>

    <!-- Step 1: Email -->
    <div *ngIf="(currentStep$ | async) === 0">
      <form [formGroup]="emailFormGroup" class="space-y-4">
        <app-input-text
          [control]="getControl('email')!"
          [label]="'Email Address'"
          [placeholder]="'you@example.com'"
          [type]="'email'"
        ></app-input-text>

        <button
          mat-raised-button
          color="primary"
          (click)="sendOTP()"
          [disabled]="emailFormGroup.invalid || (sendingOTP$ | async)"
          class="w-full"
        >
          {{ (sendingOTP$ | async) ? 'Sending...' : 'Send OTP' }}
        </button>

        <button mat-button color="primary" (click)="goToLogin()" class="w-full mt-2">
          Back to Login
        </button>
      </form>
    </div>

    <!-- Step 2: OTP -->
    <div *ngIf="(currentStep$ | async) === 1">
      <form [formGroup]="otpFormGroup" class="space-y-4">
        <p class="text-sm text-gray-500">
          Code sent to {{ email$ | async }}
        </p>

        <mat-form-field class="w-full">
          <mat-label>OTP Code</mat-label>
          <input matInput type="text" formControlName="otp" placeholder="000000" maxlength="6" />
          <mat-icon matPrefix>pin</mat-icon>
          <mat-error *ngIf="otpFormGroup.get('otp')?.hasError('required')">OTP is required</mat-error>
          <mat-error *ngIf="otpFormGroup.get('otp')?.hasError('pattern')">OTP must be 6 digits</mat-error>
        </mat-form-field>

        <button
          mat-button
          color="primary"
          (click)="resendOTP()"
          [disabled]="!(canResendOTP$ | async)"
        >
          Resend OTP {{ !(canResendOTP$ | async) ? '(' + (otpTimer$ | async) + 's)' : '' }}
        </button>

        <div class="flex justify-between">
          <button mat-stroked-button color="primary" (click)="previousStep()">Back</button>
          <button
            mat-raised-button
            color="primary"
            (click)="verifyOTP()"
            [disabled]="otpFormGroup.invalid || (verifyingOTP$ | async)"
          >
            {{ (verifyingOTP$ | async) ? 'Verifying...' : 'Continue' }}
          </button>
        </div>
      </form>
    </div>

    <!-- Step 3: New Password -->
    <div *ngIf="(currentStep$ | async) === 2">
      <form [formGroup]="passwordFormGroup" class="space-y-4">
        <app-input-text
          [control]="getControl('newPassword')!"
          [label]="'New Password'"
          [placeholder]="'Enter password'"
          [type]="hidePassword ? 'password' : 'text'"
          (toggleVisibility)="hidePassword = !hidePassword"
        ></app-input-text>

        <app-input-text
          [control]="getControl('confirmPassword')!"
          [label]="'Confirm Password'"
          [placeholder]="'Confirm password'"
          [type]="hideConfirmPassword ? 'password' : 'text'"
          (toggleVisibility)="hideConfirmPassword = !hideConfirmPassword"
        ></app-input-text>

        <div class="flex justify-between">
          <button mat-stroked-button color="primary" (click)="previousStep()">Back</button>
          <button
            mat-raised-button
            color="primary"
            (click)="resetPassword()"
            [disabled]="passwordFormGroup.invalid || (resettingPassword$ | async)"
          >
            {{ (resettingPassword$ | async) ? 'Resetting...' : 'Reset Password' }}
          </button>
        </div>
      </form>
    </div>

    <!-- Step 4: Success -->
    <div *ngIf="(currentStep$ | async) === 3" class="flex flex-col items-center justify-center text-center py-10 space-y-4">
      <mat-icon class="text-green-500 text-6xl">check_circle</mat-icon>
      <h2 class="text-2xl font-semibold text-gray-800">Success!</h2>
      <p class="text-gray-600">Your password has been reset successfully.</p>
      <button mat-raised-button color="primary" (click)="goToLogin()">Go to Login</button>
    </div>

  </mat-card>
</div>
